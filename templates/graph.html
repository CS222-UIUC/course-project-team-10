<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monthly Income Trend</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='graph.css') }}" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600&display=swap" rel="stylesheet" />
  </head>
  <body>
    <h1>Monthly Income Trend</h1>

    <div id="income-trend-plot"></div>

    <select id="function-type">
      <option value="Income" selected>Income</option>
      <option value="Spending">Spending</option>
      <option value="Balance">Balance</option>
    </select>

    <select id="range">
      <option value="Monthly" selected>Monthly</option>
      <option value="Yearly">Yearly</option>
      <option value="Custom">Custom</option>
    </select>

    <!-- Add input fields for year and month -->
    <label for="year">Year:</label>
    <input type="number" id="year" name="year" value="2022" min="1900" max="2100">
    <label for="month">Month:</label>
    <input type="number" id="month" name="month" value="12" min="1" max="12">

    <!-- Add a button to update the graph -->
    <button id="update-trend">Update</button>

    <script>
      function updateGraph() {
        var year = document.getElementById("year").value;
        var month = document.getElementById("month").value;

        $.getJSON(`/trend_monthly_income/${year}/${month}`, function (data) {
          var trace = {
            x: data.map((row) => row.Days),
            y: data.map((row) => row.Income),
            mode: "lines+markers",
            type: "scatter",
          };

          var layout = {
            title: "Monthly Income Trend",
            xaxis: { title: "Day of the Month" },
            yaxis: { title: "Income" },
          };

          Plotly.newPlot("income-trend-plot", [trace], layout);

          var functionType = document.getElementById("function-type");
          var range = document.getElementById("range");

          functionType.addEventListener("change", function () {
            // update trace based on function type
            var y = null;

            if (functionType.value === "Income") {
              y = data.map((row) => row.Income);
            } else if (functionType.value === "Spending") {
              y = data.map((row) => row.Spending);
            } else if (functionType.value === "Balance") {
              y = data.map((row) => row.Balance);
            }

            var updatedTrace = {
              x: data.map((row) => row.Days),
              y: y,
              mode: "lines+markers",
              type: "scatter",
            };

            Plotly.update("income-trend-plot", [updatedTrace], layout);
          });

         
          range.addEventListener("change", function () {
            // update layout based on range
            var updatedLayout = {};

            if (range.value === "Monthly") {
              updatedLayout = {
                title: "Monthly Income Trend",
                xaxis: { title: "Day of the Month" },
                yaxis: { title: functionType.value },
              };
            } else if (range.value === "Yearly") {
              updatedLayout = {
                title: "Yearly Income Trend",
                xaxis: { title: "Month" },
                yaxis: { title: functionType.value },
              };
            } else if (range.value === "Custom") {
              updatedLayout = {
                title: "Custom Income Trend",
                xaxis: { title: "Custom Axis Label" },
                yaxis: { title: functionType.value },
              };
            }

            Plotly.update("income-trend-plot", [trace], updatedLayout);
          });
        });
      }

      // Call the updateGraph function when the page loads
      $(document).ready(function () {
        updateGraph();
      });

      // Add an event listener for the "Update" button
      $("#update-trend").on("click", function () {
        updateGraph();
      });
    </script>

    <form action="/" method="get">
      <button type="submit">Return Back</button>
    </form>
  </body>
</html>
